function displayErrorMessage(e){alert("Time out to retrieve data."),console.log("alert",e)}require(["dojo/dom","dojo/dom-class","esri/Map","esri/views/MapView","esri/layers/MapImageLayer","esri/widgets/Search","esri/tasks/Locator","dojo/query","dojo/dom-construct","js/template.js","js/MultiSearch.js","js/NewSearch.js","js/AddressSuggestion.js","dojo/domReady!"],function(e,t,n,o,r,a,s,i,c,l){"use strict";var d,u,p,m,g=new locationService.MultiSearch(multilSearch_settings),h=locationService.AddressSuggestion(),v=l();(function(e){var t=new r(e.mapInTop.mapImageLayer),i=new n({basemap:e.mapInTop.basemap,layers:[t]});d=new o({container:"viewDiv",map:i,zoom:e.mapInTop.zoom,center:e.mapInTop.center}),u=new n({basemap:"topo",layers:[new r(e.subMap.baseMap.map)]}),p=new o({container:"subMapView",map:u,zoom:12,center:e.mapInTop.center,constraints:{rotationEnabled:!1}});var c=e.locator.sourceSetting;c.locator=new s({url:e.locator.locatorUrl}),m=new a({view:d,container:"search",allPlaceholder:".",locationEnabled:!1,sources:[c]})})(appSetting),t.remove("main-content","d-none"),i("input","search")[0].autofocus=!0,i(".collapsed","nodeResult").forEach(function(n){n.onclick=function(){var n=e.byId(this.getAttribute("aria-controls"));t.toggle(n,"show");var o=this.firstElementChild;t.contains(o,"esri-icon-minus")?(t.add(o,"esri-icon-plus"),t.remove(o,"esri-icon-minus")):(t.add(o,"esri-icon-minus"),t.remove(o,"esri-icon-plus"))}}),i(".closeButton","main-content").forEach(function(n){n.onclick=function(){var n=e.byId(this.getAttribute("aria-controls"));t.add(n,"d-none")}}),function(t){var n=e.byId("street-condition-legend");c.create("p",{innerHTML:t.title},n);var o=c.create("table",null,n),r=c.create("tbody",null,o);t.renderer.map(function(e){var t;switch(e.type){case"polyline":t="".concat('<line x1="0" y1="10" x2="20" y2="10" style="stroke:',e.color,";stroke-width:",e.size,'" />');break;case"polygon":t="".concat('<polygon points="0,0 0,20 20,20 20,0" style="fill:',e.color,';stroke:black;stroke-width:1" />');break;default:t="".concat('  <circle cx="',e.size,'" cy="',e.size,'" r="',e.size/2,'" stroke="black" stroke-width="1" fill="',e.color,'" />')}t="".concat(' <svg height="20" width="20">',t,"</svg>");var n=c.create("tr",null,r);c.create("td",{innerHTML:t,width:35},n),c.create("td",{innerHTML:e.label},n)})}(appSetting.subMap.streetCondition.legend),m.on("search-start",function(n){t.add("nodeResult","d-none"),t.add("suggestedAddresses","d-none"),t.add("ews_link","d-none"),e.byId("street-condition-checkbox").checked=!1,t.add("street-condition-legend","d-none"),i(".spinner-grow").forEach(function(e){t.contains(e,"d-none")&&t.remove(e,"d-none")}),i("ul","nodeResult").forEach(function(e){e.innerHTML=""})}),m.on("search-complete",function(n){if(0==n.numResults){var o=function(){m.search(this.textContent)};t.remove("suggestedAddresses","d-none"),h.suggestion(e.byId("address-links"),o,n.searchTerm,g.mapService,appSetting.aliasExtend)}}),m.on("select-result",function(e){if(d.zoom=12,e.result){console.log("Address found"),e.result.name&&window.history.pushState("new-address",e.result.name,"?address="+e.result.name.replace(/ /g,"%20")),t.remove("nodeResult","d-none");var n=new locationService.NewSearch(e.result,v,g.containerList);n.getParcelInfo(g.mapService.address,g.mapService.parcel,g.parcelDataList),n.getCrimeData(v.generateCrimeMapIframe),n.showSubMap(p),n.projectToStatePlane(g.spatialReference,g.mapService.geometry).then(function(e){n.geometryStatePlane=e[0],n.getNearestCityFacilityList(g.cityFacilityList),n.getLocatedServiceZoneList(g.serviceZoneSourceList),console.log("newSearch",n)}).catch(function(e){console.log("Error on projectToStatePlane/ getDistanceToFacilities/ getLocatedServiceZoneList:",e),displayErrorMessage(e)})}}),e.byId("street-condition-toggle").addEventListener("change",function(){var n=e.byId("street-condition-checkbox").checked,o=e.byId("street-condition-legend");if(n){t.contains(o,"d-none")&&t.remove(o,"d-none");var a=new r(appSetting.subMap.streetCondition.map);u.layers.add(a)}else{0==t.contains(o,"d-none")&&t.add(o,"d-none");a=u.layers.items.filter(function(e){return e.url==appSetting.subMap.streetCondition.map.url})[0];u.remove(a)}}),function(){function e(e){for(var t=window.location.search.substring(1),n=t.split("&"),o=0;o<n.length;o++){var r=n[o].split("=");if(r[0]==e)return r[1]}return!1}var t=e("address");t&&m.search(t.replace(/%20/g," "))}()});