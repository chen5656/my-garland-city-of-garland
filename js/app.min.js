function displayErrorMessage(e){alert("Time out to retrieve data. Please refresh the page."),console.log("alert",e)}var template=new myGarland.templates,saveToIndexDB=new myGarland.clientStorage;require(["dojo/dom","dojo/dom-class","esri/Map","esri/views/MapView","esri/layers/MapImageLayer","esri/widgets/Search","esri/tasks/Locator","dojo/query","dojo/dom-construct","js/MultiSearch.js","js/AddressSuggestion.js","js/NewSearch.js","dojo/domReady!"],function(e,t,n,o,a,r,i,s,c,d,l){"use strict";function u(e){t.remove("nodeResult","d-none"),window.history.pushState("new-address-id",e,"?addressId="+e);var n=new locationService.NewSearch(e);n.getAddressInfo().then(function(){f.searchTerm.trim().length<2&&(f.searchTerm=n.address),n.getNearestCityFacilityList(h.cityFacilityList),n.projectToSpatialReference([n.geometryStatePlane],p.spatialReference).then(function(e){n.geometry=e[0],n.addResultToMap(p),n.addResultToMap(m),n.getParcelInfo(h.parcelDataList).then(function(){saveToIndexDB.insertInfo("adressId-"+n.addressId,{address:n.address,geometry:{latitude:n.geometry.latitude,longitude:n.geometry.longitude},geometryStatePlane:{x:n.geometryStatePlane.x,y:n.geometryStatePlane.y},parcelInfo:n.parcelInfo})}),n.getLocatedServiceZoneList(h.serviceZoneSourceList),console.log("newSearch",n),n.getCrimeData()}).catch(function(e){console.log("Error on projectToStatePlane/ getDistanceToFacilities/ getLocatedServiceZoneList:",e),displayErrorMessage(e)})}),n.showEWSLink()}var p,g,m,f;(function(){e.byId("offline").innerHTML="";var t=new a(appSetting.mapInTop.mapImageLayer),r=new n({basemap:appSetting.mapInTop.basemap,layers:[t]});p=new o({container:"viewDiv",map:r,zoom:appSetting.mapInTop.zoom,center:appSetting.mapInTop.center}),g=new n({basemap:"topo",layers:[new a(appSetting.subMap.baseMap.map)]}),m=new o({container:"subMapView",map:g,zoom:18,center:appSetting.mapInTop.center,constraints:{rotationEnabled:!1}})})();var h=new d(multilSearch_settings);h.getCityFacilityList(multilSearch_settings.cityFacilitySourceList).then(function(){var n=appSetting.locator.sourceSetting;n.locator=new i({url:appSetting.locator.locatorUrl}),f=new r({view:p,container:"search",includeDefaultSources:!1,allPlaceholder:".",locationEnabled:!1,sources:[n]}),f.on("search-start",function(n){t.add("nodeResult","d-none"),t.add("suggestedAddresses","d-none"),t.add("ews_link","d-none"),e.byId("street-condition-checkbox").checked=!1,t.add("street-condition-legend","d-none"),s(".spinner-grow").forEach(function(e){t.contains(e,"d-none")&&t.remove(e,"d-none")}),s("ul","nodeResult").forEach(function(e){e.innerHTML=""})}),f.on("search-complete",function(e){if(0==e.numResults){var n=function(){f.search(this.textContent)};t.remove("suggestedAddresses","d-none"),y.suggestion("address-links",n,e.searchTerm,h.mapService)}}),f.on("select-result",function(e){p.zoom=12,e.result&&(saveToIndexDB.insertInfo("term-"+this.searchTerm.trim(),{addressId:e.result.feature.attributes.Ref_ID}),u(e.result.feature.attributes.Ref_ID))}),function(){function e(e){for(var t=window.location.search.substring(1),n=t.split("&"),o=0;o<n.length;o++){var a=n[o].split("=");if(a[0]==e)return a[1]}return""}var t="".concat(e("addressId"));!isNaN(t)&&t>0&&u(t)}()});var y=l();t.remove("main-content","d-none"),s(".collapsed","nodeResult").forEach(function(n){n.onclick=function(){var n=e.byId(this.getAttribute("aria-controls"));t.toggle(n,"show");var o=this.firstElementChild;t.contains(o,"esri-icon-minus")?(t.add(o,"esri-icon-plus"),t.remove(o,"esri-icon-minus")):(t.add(o,"esri-icon-minus"),t.remove(o,"esri-icon-plus"))}}),s(".closeButton","main-content").forEach(function(n){n.onclick=function(){var n=e.byId(this.getAttribute("aria-controls"));t.add(n,"d-none")}}),function(t){var n=e.byId("street-condition-legend");c.create("p",{innerHTML:t.title},n);var o=c.create("table",null,n),a=c.create("tbody",null,o);t.renderer.map(function(e){var t;switch(e.type){case"polyline":t="".concat('<line x1="0" y1="10" x2="20" y2="10" style="stroke:',e.color,";stroke-width:",e.size,'" />');break;case"polygon":t="".concat('<polygon points="0,0 0,20 20,20 20,0" style="fill:',e.color,';stroke:black;stroke-width:1" />');break;default:t="".concat('  <circle cx="',e.size,'" cy="',e.size,'" r="',e.size/2,'" stroke="black" stroke-width="1" fill="',e.color,'" />')}t="".concat(' <svg height="20" width="20">',t,"</svg>");var n=c.create("tr",null,a);c.create("td",{innerHTML:t,width:35},n),c.create("td",{innerHTML:e.label},n)})}(appSetting.subMap.streetCondition.legend),e.byId("street-condition-toggle").addEventListener("change",function(){var n=e.byId("street-condition-checkbox").checked,o=e.byId("street-condition-legend");if(n){t.contains(o,"d-none")&&t.remove(o,"d-none");var r=new a(appSetting.subMap.streetCondition.map);g.layers.add(r)}else{0==t.contains(o,"d-none")&&t.add(o,"d-none");r=g.layers.items.filter(function(e){return e.url==appSetting.subMap.streetCondition.map.url})[0];g.remove(r)}})});