function iterationCopy(e){var t={};for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t}function displayErrorMessage(e){alert("Time out to retrieve data."),console.log("alert",e)}require(["dojo/dom","dojo/dom-class","esri/Map","esri/views/MapView","esri/layers/MapImageLayer","esri/widgets/Search","esri/tasks/Locator","esri/tasks/support/Query","esri/tasks/QueryTask","dojo/query","dojo/dom-construct","js/template.js","js/MultiSearch.js","js/NewSearch.js","dojo/domReady!"],function(e,t,n,r,o,a,s,i,c,l,d,u){"use strict";var T,p,m,f,E=new locationService.MultiSearch(multilSearch_settings),g=u();(function(e){var t=new o(e.mapInTop.mapImageLayer),i=new n({basemap:e.mapInTop.basemap,layers:[t]});T=new r({container:"viewDiv",map:i,zoom:e.mapInTop.zoom,center:e.mapInTop.center}),p=new n({basemap:"topo",layers:[new o(e.subMap.baseMap.map)]}),m=new r({container:"subMapView",map:p,zoom:12,center:e.mapInTop.center,constraints:{rotationEnabled:!1}});var c=e.locator.sourceSetting;c.locator=new s({url:e.locator.locatorUrl}),f=new a({view:T,container:"search",allPlaceholder:".",locationEnabled:!1,sources:[c]})})(appSetting),t.remove("main-content","d-none"),l("input","search")[0].autofocus=!0,l(".collapsed","nodeResult").forEach(function(n){n.onclick=function(){var n=e.byId(this.getAttribute("aria-controls"));t.toggle(n,"show");var r=this.firstElementChild;t.contains(r,"esri-icon-minus")?(t.add(r,"esri-icon-plus"),t.remove(r,"esri-icon-minus")):(t.add(r,"esri-icon-minus"),t.remove(r,"esri-icon-plus"))}}),l(".closeButton","main-content").forEach(function(n){n.onclick=function(){var n=e.byId(this.getAttribute("aria-controls"));t.add(n,"d-none")}}),function(t){var n=e.byId("street-condition-legend");d.create("p",{innerHTML:t.title},n);var r=d.create("table",null,n),o=d.create("tbody",null,r);t.renderer.map(function(e){var t;switch(e.type){case"polyline":t="".concat('<line x1="0" y1="10" x2="20" y2="10" style="stroke:',e.color,";stroke-width:",e.size,'" />');break;case"polygon":t="".concat('<polygon points="0,0 0,20 20,20 20,0" style="fill:',e.color,';stroke:black;stroke-width:1" />');break;default:t="".concat('  <circle cx="',e.size,'" cy="',e.size,'" r="',e.size/2,'" stroke="black" stroke-width="1" fill="',e.color,'" />')}t="".concat(' <svg height="20" width="20">',t,"</svg>");var n=d.create("tr",null,o);d.create("td",{innerHTML:t,width:35},n);d.create("td",{innerHTML:e.label},n)})}(appSetting.subMap.streetCondition.legend),f.on("search-start",function(n){t.add("nodeResult","d-none"),t.add("suggestedAddresses","d-none"),t.add("ews_link","d-none"),e.byId("street-condition-checkbox").checked=!1,t.add("street-condition-legend","d-none"),l(".spinner-grow").forEach(function(e){t.contains(e,"d-none")&&t.remove(e,"d-none")}),l("ul","nodeResult").forEach(function(e){e.innerHTML=""})}),f.on("search-complete",function(n){function r(e,t){var n=t.length-1;if(t.length>5){for(var r=0;r<t.length;r++)if(e<t[r].streetNumber){n=t.length-(r+3)<0?t.length-1:r+2;break}return n<4&&(n=4),[t[n-4],t[n-3],t[n-2],t[n-1],t[n]]}return t}function o(n,r){var o,a={},s=[];for(var i in n)void 0===a[n[i].attributes.STREETLABEL]&&s.push(n[i].attributes.STREETLABEL),a[n[i].attributes.STREETLABEL]=0;o=0==r?"":r+" ",t.remove("suggestedAddresses","d-none");var c=e.byId("address-links");c.innerHTML="",d.create("p",{innerHTML:"Did you mean?"},c);var u=d.create("ul",null,c);s.slice(0,5).forEach(function(e){var t=d.create("li",null,u);d.create("button",{className:"btn btn-link",innerHTML:""+o+e},t)}),l(".btn-link","suggestedAddresses").forEach(function(e){e.onclick=function(){f.search(this.textContent)}})}function a(e){var t={"1ST":"FIRST","2ND":"SECOND","3RD":"THIRD","4TH":"FOURTH","5TH":"FIFTH","6TH":"SIXTH","7TH":"SEVENTH","9TH":"NINTH","10TH":"TENTH","11TH":"ELEVENTH","12TH":"TWELFTH","13TH":"THIRTEENTH","15TH":"FIFTEENTH","16TH":"SIXTEENTH","17TH":"SEVENTEENTH",1:"FIRST",2:"SECOND",3:"THIRD",4:"FOURTH",5:"FIFTH",6:"SIXTH",7:"SEVENTH",9:"NINTH",10:"TENTH",11:"ELEVENTH",12:"TWELFTH",13:"THIRTEENTH",15:"FIFTEENTH",16:"SIXTEENTH",17:"SEVENTEENTH"},n=e.split(" ");return n=n.map(function(e){return t[e]?t[e]:e}),n.join(" ").trim()}if(0==n.numResults){var s,u,T=n.searchTerm.split(",")[0].trim().toUpperCase(),p=T.split(" ");if(p.length>1){var m=p[0];m!=parseInt(m,10)?(s=T,u=0):(p.shift(),s=p.join(" "),u=m)}else s=T,u=0;s=a(s);var g=new i({where:"STREETLABEL LIKE '%"+s+"%'",returnGeometry:!1,outFields:["*"]}),h=new c({url:E.mapService.address});h.execute(g).then(function(n){var a=[];if(n.features.length>0){console.log("correct street label, wrong address number"),a=n.features.map(function(e){return{streetNumber:e.attributes.STREETNUM,streetLabel:e.attributes.STREETLABEL}}).sort(function(e,t){return e.streetNumber-t.streetNumber}),t.remove("suggestedAddresses","d-none");var T=e.byId("address-links");T.innerHTML="",d.create("p",{innerHTML:"Did you mean?"},T);var p=d.create("ul",null,T);r(u,a).forEach(function(e){var t=d.create("li",null,p);d.create("button",{className:"btn btn-link",innerHTML:e.streetNumber+" "+e.streetLabel},t)}),l(".btn-link","suggestedAddresses").forEach(function(e){e.onclick=function(){f.search(this.textContent)}})}else{for(var m=s.split(" "),g=m[0],h=1;h<m.length;h++)g.length<m[h].length&&(g=m[h]);var v=new i({where:"STREETLABEL LIKE '%"+g+"%'",returnGeometry:!1,outFields:["*"]});console.log(v.where);var b=new c({url:E.mapService.road});b.execute(v).then(function(n){if(n.features.length>0)console.log("wrong street label. find street name in road table"),o(n.features,u);else{var r=new i({where:"STREETNAME LIKE '%"+g+"%'",returnGeometry:!1,outFields:["*"]}),a=new c({url:E.mapService.streetAlias});a.execute(r).then(function(n){n.features.length>0?(console.log("wrong street label. find street name in alias table"),o(n.features,u)):(t.remove("suggestedAddresses","d-none"),e.byId("address-links").innerHTML="<p>Couldn't find entered address. </p><p>Please check the address name.</p>")})}})}})}}),f.on("select-result",function(e){if(T.zoom=12,e.result){console.log("Address found"),e.result.name&&window.history.pushState("new-address",e.result.name,"?address="+e.result.name.replace(/ /g,"%20")),t.remove("nodeResult","d-none");var n=new locationService.NewSearch(e.result,g,E.containerList);n.getParcelInfo(E.mapService.address,E.mapService.parcel,E.parcelDataList),n.getCrimeData(g.generateCrimeMapIframe),n.showSubMap(m),n.projectToStatePlane(E.spatialReference,E.mapService.geometry).then(function(e){n.geometryStatePlane=e[0],n.getNearestCityFacilityList(E.cityFacilityList),n.getLocatedServiceZoneList(E.serviceZoneSourceList),console.log("newSearch",n)}).catch(function(e){console.log("Error on projectToStatePlane/ getDistanceToFacilities/ getLocatedServiceZoneList:",e),displayErrorMessage(e)})}}),e.byId("street-condition-toggle").addEventListener("change",function(){var n=e.byId("street-condition-checkbox").checked,r=e.byId("street-condition-legend");if(n){t.contains(r,"d-none")&&t.remove(r,"d-none");var a=new o(appSetting.subMap.streetCondition.map);p.layers.add(a)}else{0==t.contains(r,"d-none")&&t.add(r,"d-none");a=p.layers.items.filter(function(e){return e.url==appSetting.subMap.streetCondition.map.url})[0];p.remove(a)}}),function(){function e(e){for(var t=window.location.search.substring(1),n=t.split("&"),r=0;r<n.length;r++){var o=n[r].split("=");if(o[0]==e)return o[1]}return!1}var t=e("address");t&&f.search(t.replace(/%20/g," "))}()});